<html>
	<head>
		<title>WebSockets on Azure</title>
		<script src="//ajax.googleapis.com/ajax/libs/jquery/2.1.0/jquery.min.js"></script>
		<script type="text/javascript">
		</script>
	</head>	
	<body>
		<form>
			<label for="nickname">nick:</label><br/>
			<input type="text" id="nickname"/><br/>
			<label for="message">message:</label><br/>
			<input type="text" id="message"/><br/>
			<input type="button" id="sendbutton" value="Send"/>
		</form>
		<ul id="chatlog"></ul>
		<script type="text/javascript">
			$(function() {

				// Setup the Web Socket Connection
				var host = location.origin.replace(/^http/, "ws");
				var ws = new WebSocket(host);
				
				ws.onmessage = function(e) {
					var msg = JSON.parse(e.data);
					var entry = "<li><strong>" + msg.name + ":</strong> " + msg.text + "</li>";
					$("#chatlog").append(entry);
				};

				var sendMessage = function(name, text) {
					var msg = {
						name: name,
						text: text
					};
					ws.send(JSON.stringify(msg));
				};

				$("#sendbutton").click(function() {
					var name = $("#nickname").val();
					var text = $("#message").val();
					sendMessage(name, text);
				});
			});
		</script>
	</body>
</html>